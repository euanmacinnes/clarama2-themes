<div class="container-fluid row tight" style="height: 100%; padding-bottom: 2px;">
    <div id="{{ target }}" element-type="{{ file_type }}" grid-id="{{ grid_id }}" autorun="{{ autorun }}"
        class="col clarama-element clarama-post-embedded clarama-edit-element slate-panel-target tight"
        url="{{ embedded_url }}" onload="add_topic('{{element_content_url}}');">
    </div>
    <div id="grid-elem-dropdown-{{ target }}" class="dropdown col-auto align-middle tight"
        style="position: absolute; top: 4px; right: 3px;">
        <i class="bi bi-three-dots-vertical element_editor grid-elem-menu" data-bs-toggle="dropdown" data-bs-auto-close="outside"
            aria-expanded="false" target="{{ target }}" elems="{{ grid_id }}" title="{{ target }}"></i>
        <ul class="dropdown-menu embedded-dropdown-menu grid-element-dropdown-menu">
            <li class="dropdown-item">
                <div class="input-group">
                    <button type="button" class="btn btn-outline-primary input-group-text" data-bs-toggle="modal" id="browseFileBtn"
                        data-bs-target="#browseFileModal"
                        inputId="{{ target }}_elemInput"
                        filters="*.field.yaml|*.task.yaml|*.md">
                        <i class="bi bi-folder2-open"></i>
                    </button>

                    <div class="input-group-text" style="text-wrap: auto;"><a id="{{ target }}_elemInput" href="/content/edit/{{ element_content_url }}" target="_blank">{{ target_element['url'] }}</a></div>

                    <button type="button" class="btn btn-outline-secondary border-end-0 p-1" onclick="clearInput('{{ target }}_elemInput', 'url', '{{ target }}', event)" style="font-size: 1rem;border-color: #dee2e6;">
                      <i class="bi bi-x"></i>
                    </button>

                    <span class="input-group-text">?</span>

                    <input type="text" class="form-control removeInputFocus" id="{{ target }}_paramsInput" placeholder="my_param=something"
                            value="{{ target_element['params'] }}">

                    <button type="button" class="btn btn-outline-secondary p-1 border-end-0" onclick="clearInput('{{ target }}_paramsInput', 'params', '{{ target }}', event)" style="font-size: 1rem;border-color: #dee2e6;">
                        <i class="bi bi-x"></i>
                    </button>

                    <!-- <button class="btn btn-outline-primary" type="button" id="saveParamsBtn" onclick="saveElementParams('{{ target }}')"><i class="bi bi-floppy"></i></button> -->


                    <button class="btn btn-outline-primary" type="button" id="saveParamsBtn" onclick="delete_element('{{ target }}')"><i class="bi bi-trash"></i></button>
                </div>
            </li>
            <li>
                <hr class="dropdown-divider">
            </li>
            {% if field %}
            <li class="dropdown-item">
                <select class="form-control" id="{{ target }}_layout" onchange="saveElementParams('{{ target }}')">
                    <option id="text_left" {{ selected("text_left", target_element['layout']) }}>Left-Aligned Text</option>
                    <option id="text_right" {{ selected("text_right", target_element['layout']) }}>Right-Aligned Text</option>
                    <option id="text_top" {{ selected("text_top", target_element['layout']) }}>Text appears on top</option>
                    <option id="text_bottom" {{ selected("text_bottom", target_element['layout']) }}>Text appears underneath</option>
                    <option id="text_grouped" {{ selected("text_grouped", target_element['layout']) }}>Grouped. Text appears on left, boxed, with a</option>
                    <option id="tight" {{ selected("tight", target_element['layout']) }}>Tight (small, title only)</option>
                    <option id="basic" {{ selected("basic", target_element['layout']) }}>Basic (No text shown)</option>
                </select>
            </li>
            {% else %}
            <li class="dropdown-item d-flex">
                <input type="checkbox" {{ get_checked }} id="{{ target }}_refresh" class="me-1" onchange="saveElementParams('{{ target }}')">
                <label class="{{ target }}_refresh">Auto-Refresh Task</label>
            </li>
            {% endif %}
            <li class="dropdown-item d-flex">
                <input type="checkbox" id="{{ target }}_fit" class="me-1" onchange="saveElementParams('{{ target }}')">
                <label class="{{ target }}_fit">Auto-Fill</label>
            </li>
            <li class="dropdown-item">

            </li>
            {% if grid_id %}
            <li>
                <hr class="dropdown-divider">
            </li>
            <li>
                <h6 class="dropdown-header mb-1">Interactions</h6>                
            </li>

            <!-- Actions group (non-menu interactions) -->
            <li class="dropdown-item">
                <div class="gi-actions-bar d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <strong class="me-3">Actions</strong>
                        <div class="gi-grid gi-grid--actions gi-hdr d-flex align-items-center">
                            <span class="gi-col-title gi-col-title-action--type"></span>
                            <span class="gi-col-title gi-col-title-action--element">Element</span>
                            <span class="gi-col-title gi-col-title-action--source">Source &amp; Params</span>
                            <span class="gi-col-title gi-col-title-action--wait">Wait</span>
                        </div>
                    </div>
                
                    <i class="bi bi-plus-circle grid-interaction-add" title="Add Action" 
                        style="cursor:pointer;" onclick="add_interaction('{{ target }}', false)"></i>
                </div>
            </li>
            <div id="grid_element_target_actions-{{ target }}">
                {% for link in elements[target]['links'] %}
                    {% if not link.contextMenu %}
                        {% set uid = link.uid %}
                        {% set current_element = link.element if link.element is defined else link %}
                        {% set current_element_url = link.url if link.element is defined else elements[link]['url'] %}
                        {% set current_element_params = link.params if link.element is defined else elements[link]['params'] %}
                        {% set do_wait = link.wait if link.wait is defined else false %}
                        {% include theme("explorer/files/_grid_interaction_edit.html") %}
                    {% endif %}
                {% endfor %}
            </div>

            <!-- Menu group (context menu items) -->
            <li class="dropdown-item">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <strong class="me-2">Menu</strong>
                        <div class="gi-grid gi-grid--actions gi-hdr d-flex align-items-center">
                            <span class="gi-col-title gi-col-title-menu--type"></span>
                            <span class="gi-col-title gi-col-title-menu--element">Element</span>
                            <span class="gi-col-title gi-col-title-menu--source">Source &amp; Params</span>
                            <span class="gi-col-title gi-col-title-menu--wait">Wait</span>
                            <span class="gi-col-title gi-col-title-menu--menu-name">Menu Name</span>
                        </div>
                    </div>
                    <i class="bi bi-plus-circle grid-interaction-add" title="Add Menu Item" style="cursor: pointer;"
                       onclick="add_interaction('{{ target }}', true)"></i>
                </div>
            </li>
            <div id="grid_element_target_menu-{{ target }}">
                {% for link in elements[target]['links'] %}
                    {% if link.contextMenu %}
                        {% set uid = link.uid %}
                        {% set current_element = link.element if link.element is defined else link %}
                        {% set current_element_url = link.url if link.element is defined else elements[link]['url'] %}
                        {% set current_element_params = link.params if link.element is defined else elements[link]['params'] %}
                        {% set do_wait = link.wait if link.wait is defined else false %}
                        {% set menu_item_name = link.menu_item_name %}
                        {% include theme("explorer/files/_grid_interaction_edit.html") %}
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}
        </ul>
    </div>
</div>
